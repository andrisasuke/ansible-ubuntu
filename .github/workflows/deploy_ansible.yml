name: deploy ansible

on:
  push:
    branches:
    - main
  pull_request:
    branches:
    - main

jobs:
  deploy_ubuntu_latest:
    runs-on: ubuntu-latest
    steps:
    - name: checkout repo
      uses: actions/checkout@v2
    - name: Install ansible playbook
      run: |
        sudo apt update
        sudo apt install software-properties-common
        sudo add-apt-repository --yes --update ppa:ansible/ansible
        sudo apt install ansible
    - name: Run ansible playbook
      run: ansible-playbook -i dev-server/tests/inventory-runner-test ubuntu.yaml

  deploy_ubuntu_aarch64:
    runs-on: ubuntu-20.04
    name: Build on ubuntu-20.04 aarch64
    steps:
      - uses: actions/checkout@v2.1.0
      - uses: uraimo/run-on-arch-action@v2
        name: Deploy ansible playbook
        id: deploy_ansible_playbook
        with:
          arch: aarch64
          distro: ubuntu20.04

          githubToken: ${{ github.token }}

          run: |
            apt update
            apt --yes install software-properties-common
            add-apt-repository --yes --update ppa:ansible/ansible
            apt --yes install curl ansible
            ansible-playbook -i dev-server/tests/inventory-ubuntu-aarch64-test ubuntu.yaml
            
